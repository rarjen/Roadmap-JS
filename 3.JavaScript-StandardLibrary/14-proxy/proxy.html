<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>proxy</title>
  </head>
  <body>
    <script>
      /*
        Proxy

            ● Proxy merupakan fitur yang bisa digunakan sebagai wakil sebuah data
            ● Dengan menggunakan proxy, semua interaksi ke data akan selalu melalui Proxy terlebih dahulu
            ● Dengan ini, kita bisa melakukan apapun sebelum interaksi dilakukan ke data yang dituju
            ● https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy

        Proxy Handler

            ● Pembuatan Proxy perlu menggunakan handler, dimana dalam handler, kita bisa membuat function
            yang dinamakan interceptor yang digunakan ketika mengambil data atau mengubah data ke target
            ● Untuk membuat Proxy, kita bisa menggunakan new Proxy(target, handler)

            - interceptor adl function yg selalu dipanggil ketika datanya di akses.
        */

      const target = {
        middleName: "Abiel",
      };

      //handler boleh tidak ada functionnya, berarti tdk memiliki interceptor (idelanya ada)
      //di handler ini kita bisa mengatur apakah data boleh diambil / diubah atau tidak
      const handler = {
        //memperbolehkan mengambil data
        get: function (target, property) {
          return target[property];
        },
        //memperbolehkan merubah data
        set: function (target, property, value) {
          target[property] = value;
        },
      };

      const proxy = new Proxy(target, handler);
      //jika ingin mengubah / menambahkan data jgn langsung ke target melainkan ke proxy
      //proxy akan menghubungkan ke object target
      proxy.firstName = "Otniel";
      proxy.lastName = "Kevin";

      //jika ingin mengakses properti jgn langsung ke target melainkan ke proxy
      console.info(proxy.firstName); // Otniel
      console.info(proxy.lastName); // Kevin
      console.info(proxy.middleName); //tetap bisa diakses dari handler walaupun properti sudah ada di dlm object target

      //mengecek apakah target datanya berubah
      console.info(target); // ya, berubah
      // output
      // {firstName: 'Otniel', lastName: 'Kevin'}

      {
        /*
            Proxy dan Handler
            ● Saat kita mengubah data proxy, secara otomatis data akan dikirim ke target melalui handler dengan
            memanggil function set(target, property, value)
            ● Saat kita mengambil data proxy, secara otomatis data akan diambil dari target melalui handler
            dengan memanggil function get(target, property)
            ● Artinya, jika kita ingin melakukan sesuatu sebelum dan setelah nya, bisa kita lakukan di handler
            - kita bisa menambahkan logika di dlm handler sebelum melakukan set dan get thd object target
        */

        const person = {
          middleName: "Abiel",
        };

        //log handler
        const handler = {
          //memperbolehkan mengambil data
          get: function (target, property) {
            console.info(`Access property ${property}`); //menambahkan keterangan property yg ditambahkan
            return target[property];
          },
          //memperbolehkan merubah data
          set: function (target, property, value) {
            console.info(`Access property ${property}  ${value}`); //menambahkan keterangan properti apa yg diakses dan value nya yg diubah
            target[property] = value;
          },
        };

        const proxy = new Proxy(person, handler);
        proxy.firstName = "leinto"; //memamnggil fungsi set

        console.info(proxy.firstName); //memanggil fungsi get
        console.info(proxy.middleName); //memanggil fungsi get
        console.info(person);
      }

      {
        //coba sendiri ygy
        console.info("contoh sendiri: ");
        const target = {
          middleName: "kevin",
        };

        //log handler (melakuan validasi)
        const handler = {
          //memperbolehkan mengambil data
          get: function (target, property) {
            if (property !== "middleName") {
              console.info(`Access property ${property}`);
              return target[property];
            } else {
              console.info(`maaf, middleName tidak bisa diakses`);
            }
          },
          //memperbolehkan merubah data
          set: function (target, property, value) {
            console.info(`Access property ${property}  ${value}`); //menambahkan keterangan properti apa yg diakses dan value nya yg diubah

            //jika value kosong maka akan throw error dan otomatis diisikan string : default
            try {
              if (!value) {
                throw new Error("Value tidak boleh null"); //menggunakan throw error
              } else {
                target[property] = value;
              }
            } catch (err) {
              alert(err.message);
              target[property] = "default";
            }
          },
        };

        const proxy = new Proxy(target, handler);
        proxy.firstName = "leinto";
        proxy.lastName = "";
        proxy.lastName = "lei";

        proxy.middleName; //maaf, middleName tidak bisa diakses
        proxy.firstName; //Access property firstName
        proxy.lastName;

        console.info(proxy); // Proxy {middleName: 'kevin', firstName: 'leinto'}
      }
    </script>
  </body>
</html>
